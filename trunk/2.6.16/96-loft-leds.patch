leds class support for the loft board

Signed-off-by: John Bowler <jbowler@acm.org>

---
 arch/arm/mach-ixp4xx/ixdp425-setup.c |   25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)

--- linux-ixp4xx.orig/arch/arm/mach-ixp4xx/ixdp425-setup.c	2006-02-21 01:40:48.000000000 +0100
+++ linux-ixp4xx/arch/arm/mach-ixp4xx/ixdp425-setup.c	2006-02-21 01:44:12.000000000 +0100
@@ -16,6 +16,7 @@
 #include <linux/serial_8250.h>
 #include <linux/slab.h>
 #include <linux/eeprom.h>
+#include <linux/leds.h>
 
 #include <asm/types.h>
 #include <asm/setup.h>
@@ -182,6 +183,24 @@ MACHINE_END
 #endif
 
 #ifdef CONFIG_MACH_LOFT
+#ifdef CONFIG_LEDS_CLASS
+static struct resource loft_led_resources[] = {
+	{
+		.name		= "ready",  /* green led, also J8 pin 7 */
+		.start		= 3,
+		.end		= 3,
+		.flags		= IXP4XX_GPIO_LOW,
+	},
+};
+
+static struct platform_device loft_leds = {
+	.name			= "IXP4XX-GPIO-LED",
+	.id			= -1,
+	.num_resources		= ARRAY_SIZE(loft_led_resources),
+	.resource		= loft_led_resources,
+};
+#endif
+
 /*
  * Loft is functionally equivalent to Avila except that it has a
  * different number for the maximum PCI devices.  The MACHINE
@@ -289,6 +308,12 @@ static void __init loft_fixup(struct mac
 	memcpy(*cmdline, loft_command_line, len);
 	memcpy(*cmdline + len, saved_command_line, COMMAND_LINE_SIZE - len);
 	*cmdline[COMMAND_LINE_SIZE-1] = 0;
+
+#ifdef CONFIG_LEDS_CLASS
+	/* We don't care if this fails. */
+	(void)platform_device_register(&loft_leds);
+#endif
+
 }
 
 MACHINE_START(LOFT, "Giant Shoulder Inc Loft board")
