---
 drivers/net/ixp4xx/mac_driver.c        |    6 ++++--
 include/asm-arm/arch-ixp4xx/platform.h |    1 +
 2 files changed, 5 insertions(+), 2 deletions(-)

--- linux-ixp4xx.orig/include/asm-arm/arch-ixp4xx/platform.h	2006-10-15 20:39:30.000000000 +0200
+++ linux-ixp4xx/include/asm-arm/arch-ixp4xx/platform.h	2006-10-16 10:09:46.000000000 +0200
@@ -100,6 +100,7 @@ struct mac_plat_info {
 	int phy_id;	/* ID of the connected PHY (PCB/platform dependent) */
 	int rxq_id;	/* Queue ID of the RX-free q*/
 	int txq_id;	/* Where to push the outgoing packets */
+	unsigned char hwaddr[6]; /* Desired hardware address */
 };
 
 
--- linux-ixp4xx.orig/drivers/net/ixp4xx/mac_driver.c	2006-10-16 08:37:40.000000000 +0200
+++ linux-ixp4xx/drivers/net/ixp4xx/mac_driver.c	2006-10-16 10:11:18.000000000 +0200
@@ -364,8 +364,10 @@ static int mac_probe(struct platform_dev
 
 	INIT_WORK(&mac->mdio_thread, mac_mdio_thread, dev);
 
-	memcpy(dev->dev_addr, maddr, dev->addr_len);
-	dev->dev_addr[5] = plat->phy_id;
+	if (is_zero_ether_addr(plat->hwaddr))
+                random_ether_addr(dev->dev_addr);
+	else
+		memcpy(dev->dev_addr, plat->hwaddr, 6);
 
 	printk(KERN_INFO IXMAC_VERSION ": %s on %s with PHY[%d] initialized\n",
 			dev->name, npe->plat->name, plat->phy_id);
